<%@page import="java.util.ArrayList"%>
<%@page import="vo.DeptVO"%>
<%@page import="java.util.List"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@page import="java.sql.Connection"%>
<%@page import="javax.sql.DataSource"%>
<%@page import="javax.naming.Context"%>
<%@page import="javax.naming.InitialContext"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    
<%
	//톰캣이 참조할 리소스 검색
	InitialContext ic = new InitialContext();
	//리소스파일의 위치를 검색
	Context ctx = (Context)ic.lookup("java:comp/env");
	
	//리소스의 name을 통해 사용하고자 하는 자원을 검색
	DataSource dataSource = (DataSource)ctx.lookup("jdbc/oracle_test");
	
	//DB연결하기
	Connection conn = dataSource.getConnection();
	System.out.println("---DB연결 성공---");
	
	String sql = "select * from dept";
	
	PreparedStatement pstmt = conn.prepareStatement(sql);
	
	//pstmt를 통해 쿼리문을 수행하고 검색이 완료된 결과를 ResultSet이 받는다
	ResultSet rs = pstmt.executeQuery();
	
	List<DeptVO> dept_list = new ArrayList<>();
	while( rs.next() ){
		DeptVO vo = new DeptVO();
		
		//현재 컬럼값을 vo에 담는다
		vo.setDeptNo(rs.getInt("deptno"));
		vo.setdName( rs.getString("dname") );
		vo.setLoc(rs.getString("loc"));
		
		dept_list.add(vo);
	}
	 
	//DB의 사용이 끝나면 DB접속관련 객체를 역순으로 해제
	rs.close();
	pstmt.close();
	conn.close();
%>    
    
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<table border="1">
		<caption>:::부서목록:::</caption>
		
		<tr>
			<th>부서번호</th>
			<th>부서명</th>
			<th>부서위치</th>
		</tr>
		
		<% for( int i = 0; i < dept_list.size(); i++ ){ %>
		
			<tr>
				<td><%= dept_list.get(i).getDeptNo() %></td>
					<td>
						<a href="send('<%= dept_list.get(i).getDeptNo()%>');" name="deptno">
							<%= dept_list.get(i).getdName() %>
						</a>
					</td>
				<td><%= dept_list.get(i).getLoc() %></td>
			</tr>
		
		<%} %>
	</table>
</body>
</html>



















